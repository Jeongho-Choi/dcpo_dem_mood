---
output: 
  pdf_document:
    citation_package: natbib
    keep_tex: true
    fig_caption: true
    latex_engine: pdflatex
    template: svm-latex-ms2.tex
title: "[dcpo_demsupport]"
thanks: "Corresponding author: [yuehong-tai@uiowa.edu](mailto:yuehong-tai@uiowa.edu). Current version: `r format(Sys.time(), '%B %d, %Y')`."
author:
- name: Yuehong 'Cassandra' Tai
  affiliation: University of Iowa
- name: Yue Hu
  affiliation: Tsinghua University
- name: Frederick Solt
  affiliation: University of Iowa
abstract: "Public opinion’s effect on democratic institutions is important and long-studied topic.  Claassen (2020) renewed attention to this question by using a Bayesian latent variable approach to measure mass democratic support from survey data and concluded such support has a positive effect on subsequent democratic change and especially on democracy’s endurance once in place.  In this article, we reexamine the question, bringing more survey data on democratic support; a superior measure, Dynamic Comparative Public Opinion (DCPO); and an improved methodological approach that takes the uncertainty in this measure into account.  Our results [further reinforce/contradict] the long-held view that democracies depend on public support to survive."
keywords: ""
date: "`r format(Sys.time(), '%B %d, %Y')`"
fontsize: 11pt
spacing: double
bibliography: \dummy{`r file.path(getwd(), list.files(getwd(), ".bib$", recursive = TRUE))`}
# csl: https://raw.githubusercontent.com/citation-style-language/styles/master/american-political-science-association.csl
biblio-style: apsr
citecolor: black
linkcolor: black
endnote: no
header-includes:
      - \usepackage{array}
      - \usepackage{caption}
      - \usepackage{graphicx}
      - \usepackage{siunitx}
      - \usepackage{colortbl}
      - \usepackage{multirow}
      - \usepackage{hhline}
      - \usepackage{calc}
      - \usepackage{tabularx}
      - \usepackage{threeparttable}
      - \usepackage{wrapfig}
nocite: |
  @Solt2020a
---

```{r setup, include=FALSE}
options(tinytex.verbose = TRUE)

knitr::opts_chunk$set(echo = FALSE, message = FALSE, warning = FALSE, dpi = 300)

# If you haven't install `DCPOtools`
# remotes::install_github("fsolt/DCPOtools")

if (!require(pacman)) install.packages("pacman")
library(pacman)

# load all the packages you will use below 
p_load(
  dataverse, # data scraping
  DCPOtools, # analysis
  huxtable, kableExtra, modelsummary, # tabulation
  latex2exp, # visualization
  rstan, # Bayesian estimation
  tidyverse # data wrangling
) 

# Functions preload
set.seed(313)
```

<!-- The following text is all cribbed from `fsolt/dcpo_article` and obviously needs heavy revision -->

# More Data

```{r dcpo_input_raw}
dcpo_input_raw <- DCPOtools::dcpo_setup(vars = read_csv("data-raw/mood_dem.csv",
                                                          col_types = "cccccc"),
                                          file = "data/dcpo_input_raw.csv")
```

```{r dcpo_input}
dcpo_input_raw1 <- read_csv("data/dcpo_input_raw.csv", col_types = "cdcddcd") %>% 
  filter(!(str_detect(item, "army_wvs") & # WVS obs identified as problematic by Claassen 
    ((country=="Albania" & year==1998) |
         (country=="Indonesia" & (year==2001 | year==2006)) |
         (country=="Iran" & year==2000) |
         (country=="Pakistan" & (year==1997 | year==2001)) | # 1996 in Claassen
         (country=="Vietnam" & year==2001)) |
    (str_detect(item, "strong_wvs") &
         ((country=="Egypt" & year==2012) |
              (country=="Iran" & (year==2000 | year==2007)) | # 2005 in Claassen
              (country=="India") |
              (country=="Pakistan" & (year==1997 | year==2001)) | # 1996 in Claassen
              (country=="Kyrgyzstan" & (year==2003 | year==2011)) |
              (country=="Romania" & (year==1998 | year==2005 | year==2012)) |
              (country=="Vietnam" & year==2001))) |
      (country %in% c("Puerto Rico", "Northern Ireland", 
                      "SrpSka Republic", "Hong Kong SAR China")))) %>%
  with_min_yrs(2)

dcpo_input <- DCPOtools::format_dcpo(dcpo_input_raw1,
                                     scale_q = "church_lb",
                                     scale_cp = 2)
save(dcpo_input, file = here::here("data", "dcpo_input.rda"))
```

```{r compare_n}
supdem <- dataverse::get_file("supdem raw survey marginals.tab", "doi:10.7910/DVN/HWLW0J") %>%
  read_csv(col_types = "cdcddcdc") %>% 
  janitor::clean_names() %>% 
  with_min_yrs(2)

supdem_ncy <- supdem %>%
  dplyr::select(country, year) %>% 
  unique() %>% 
  nrow()

supdem_ncyi <- supdem %>%
  dplyr::select(country, year, item) %>% 
  unique() %>% 
  nrow()

dcpo_input_ncy <- dcpo_input_raw1 %>% 
  dplyr::select(country, year) %>% 
  unique() %>% 
  nrow()

dcpo_input_ncyi <- dcpo_input_raw1 %>% 
  dplyr::select(country, year, item) %>% 
  unique() %>% 
  nrow()

increase_cy <- round((dcpo_input_ncy/supdem_ncy - 1) * 100, 1)
increase_cyi <- round((dcpo_input_ncyi/supdem_ncyi - 1) * 100, 1)
```

# A Better Measure of Democratic Support
The DCPO model is estimated using the `DCPO` package for R [@Solt2020a], which is written in the Stan probabilistic programming language [@StanDevTeam2019a; @StanDevTeam2019b].

# Incorporating Uncertainty
This means not simply employing the point estimates, that is, the means of the posterior distributions [_contra_ @Claassen2020a; @Claassen2020b].

Instead, researchers should follow the recommendations of work using other latent variables [e.g., @Schnakenberg2014; @Crabtree2015] and other measures incorporating uncertainty, such as the Standardized World Income Inequality Database [@Solt2020]: generate many duplicate versions of the analysis dataset, assign to each a different random draw from the posterior distributions of the variables measured with uncertainty, perform the analyses repeatedly on each of these multiple versions of the dataset, and combine the results following the rules set out in @Rubin1987.
The functional programming tools in the `purrr` package [@Henry2019] make this a matter of just a few additional lines of code.

# Results

# Conclusion

\pagebreak
